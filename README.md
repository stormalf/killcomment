# killcomment

python3 tool using ANTLR that removes comments from C, shell, python or SQL source code

This tool is more about learning ANTLR on Python for future projects than really useful!
I didn't find in which case we want to remove comments ;-)

It creates a new file without comments and compresses the code (see below) with extension ".woc" .

DISCLAIMER : this tool doesn't remove comments inside an instruction like in C source example : #endif /* ! C99 */
            
This tool compresses and removes comments that are in one or several lines.
Python example : 

    #!/usr/bin/python3
    # -*- coding: utf-8 -*-
    # sample docker test sdk example with python 

    import docker

    #create a file with content log for each container_id
    def output_log(container):
    filename = "docker_" + container.id
    f = open(filename, "wb")
    f.write(container.logs())
    f.close()

become : 

    import docker
    def output_log(container):
    filename = "docker_" + container.id
    f = open(filename, "wb")
    f.write(container.logs())
    f.close()    

C example :

    #define  YY_INT_ALIGNED short int

    /* A lexical scanner generated by flex */

    #define FLEX_SCANNER
    #define YY_FLEX_MAJOR_VERSION 2
    #define YY_FLEX_MINOR_VERSION 6
    #define YY_FLEX_SUBMINOR_VERSION 4
    #if YY_FLEX_SUBMINOR_VERSION > 0
    #define FLEX_BETA
    #endif

    /* First, we deal with  platform-specific or compiler-specific issues. */

    /* begin standard C headers. */
    #include <stdio.h>
    #include <string.h>
    #include <errno.h>
    #include <stdlib.h>    

become :

    #define  YY_INT_ALIGNED short int
    #define FLEX_SCANNER
    #define YY_FLEX_MAJOR_VERSION 2
    #define YY_FLEX_MINOR_VERSION 6
    #define YY_FLEX_SUBMINOR_VERSION 4
    #if YY_FLEX_SUBMINOR_VERSION > 0
    #define FLEX_BETA
    #endif
    #include <stdio.h>
    #include <string.h>
    #include <errno.h>
    #include <stdlib.h>    

Shell example :

    #!/bin/bash
    #
    # description: Test - Server
    # chkconfig: 2345 96 96
    #

    if [ -n $TEST_HOME ]; then
        export TEST_HOME=/opt/test-server
    fi

    if [ -n $TEST_USER ]; then
        export TEST_USER=root
    fi

    #environment variables
    export PID_FILE=$TEST_HOME/test-server.pid
    export PROCESS_NAME="test-server"

become : 

    if [ -n $TEST_HOME ]; then
        export TEST_HOME=/opt/test-server
    fi
    if [ -n $TEST_USER ]; then
        export TEST_USER=root
    fi
    export PID_FILE=$TEST_HOME/test-server.pid
    export PROCESS_NAME="test-server"

Sql example :    

    -- sample script H2 database
    -- 0 +/- SELECT COUNT(*) FROM db1.DB1_MYSERVERS;  
    -- table for managing servers password crypted    
    CREATE CACHED TABLE db1.DB1_MYSERVERS(
        DB1_ID INTEGER DEFAULT (NEXT VALUE FOR db1.SYSTEM_SEQUENCE_ZF1E7158_232F_4171_Z854_EZZZA28B20C0) NOT NULL NULL_TO_DEFAULT SEQUENCE db1.SYSTEM_SEQUENCE_ZF1E7158_232F_4171_Z854_EZZZA28B20C0,
        DB1_NAME VARCHAR(255),
        DB1_LOGIN VARCHAR(255),
        DB1_PWD VARCHAR(255),
        DB1_UPDDATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
        DB1_DELETED INTEGER DEFAULT 0,
        DB1_SECURED INTEGER DEFAULT 1
    );               
    ALTER TABLE db1.DB1_SERVERS ADD CONSTRAINT db1.CONSTRAINT_9 PRIMARY KEY(DB1_ID);       
    -- 0 +/- SELECT COUNT(*) FROM db1.DB1_MYVERSIONS;          
    -- table for managing software versions  
    CREATE CACHED TABLE db1.DB1_MYVERSIONS(
        VRS_ID INTEGER DEFAULT (NEXT VALUE FOR db1.SYSTEM_SEQUENCE_26Z1ZZ55_DD50_45ZZ_AC9B_1BE715F9C8F4) NOT NULL NULL_TO_DEFAULT SEQUENCE db1.SYSTEM_SEQUENCE_26Z1ZZ55_DD50_45ZZ_AC9B_1BE715F9C8F4,
        VRS_VERSION VARCHAR(255),
        VRS_COMMENT VARCHAR(4000),
        VRS_UPDDATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
        VRS_DELETED INTEGER DEFAULT 0
    );  
    -- end of script   

become : 

    CREATE CACHED TABLE db1.DB1_MYSERVERS(
        DB1_ID INTEGER DEFAULT (NEXT VALUE FOR db1.SYSTEM_SEQUENCE_ZF1E7158_232F_4171_Z854_EZZZA28B20C0) NOT NULL NULL_TO_DEFAULT SEQUENCE db1.SYSTEM_SEQUENCE_ZF1E7158_232F_4171_Z854_EZZZA28B20C0,
        DB1_NAME VARCHAR(255),
        DB1_LOGIN VARCHAR(255),
        DB1_PWD VARCHAR(255),
        DB1_UPDDATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
        DB1_DELETED INTEGER DEFAULT 0,
        DB1_SECURED INTEGER DEFAULT 1
    );               
    ALTER TABLE db1.DB1_SERVERS ADD CONSTRAINT db1.CONSTRAINT_9 PRIMARY KEY(DB1_ID);       
    CREATE CACHED TABLE db1.DB1_MYVERSIONS(
        VRS_ID INTEGER DEFAULT (NEXT VALUE FOR db1.SYSTEM_SEQUENCE_26Z1ZZ55_DD50_45ZZ_AC9B_1BE715F9C8F4) NOT NULL NULL_TO_DEFAULT SEQUENCE db1.SYSTEM_SEQUENCE_26Z1ZZ55_DD50_45ZZ_AC9B_1BE715F9C8F4,
        VRS_VERSION VARCHAR(255),
        VRS_COMMENT VARCHAR(4000),
        VRS_UPDDATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP(),
        VRS_DELETED INTEGER DEFAULT 0
    );      


# ANTLR usage 

You can find more information on antlr with python : https://github.com/antlr/antlr4/blob/master/doc/python-target.md 

Example of generating parser and lexer automatically by ANTLR : 
    antlr4 -Dlanguage=Python3 killComment.g4

If you need to extend or does some specific actions in your Parser/Lexer... it's better to create your own class that inherit from Lexer generated class, because at each antlr4 execution the parser and lexer are replaced.


# killComment usage 

The killComment tool generates a new file with extension .woc ("without comments").
python3 killComment.py --help
    usage: killComment.py [-h] [-V] [-t {py-like,c-like,shell-like,sql-like}] filename

    killComment is a python3 program that removes comment and compact code. It compacts code too but keep readable and
    executable Only some comments are taken in account : - c-like : /*...*/ and // - py-like : # and ''' and """ - shell-
    like : # - SQL-like : -- and /* */

    positional arguments:
    filename              file to remove comment and compact

    optional arguments:
    -h, --help            show this help message and exit
    -V, --version         Display the version of killComment
    -t {py-like,c-like,shell-like,sql-like}, --type {py-like,c-like,shell-like,sql-like}
                            type of comments to remove c-like, py-like, shell-like, sql-like


Examples :  

    python3 killComment.py -t sql-like db1.sql

    python3 killComment.py -t shell-like test.sh

    python3 killComment.py -t c-like lex.yy.c

    python3 killComment.py -t py-like shc_old.py

